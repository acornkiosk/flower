<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>카테고리 등록페이지</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
		crossorigin="anonymous"></script>

	<style>
		.wrapper {
			display: flex;
			/* 자식요소 일렬로 배치 */
			flex-direction: row;
			/* row | row-reverse | column | column-reverse 
			자식요소들이 일렬로 배치되는 순서와 축(가로와 세로)을 결정할 수 있다. */
			margin-top: 50px;
		}

		.box {
			flex: 1;
		}

		.box:nth-child(1) {
			flex: 1;
			margin-right: 10px;
		}

		.box:nth-child(2) {
			flex: 2;
			margin-left: 10px;
		}
	</style>

</head>

<body>
	<!-- class="container" -->
	<div class="container">

		<!-- box 의 부모요소 -->
		<div class="wrapper">

			<!-- wrapper 의 자식요소 1 -->
			<div class="box">
				<div class="card shadow mb-4">
					<!-- 추가 누르면 javascript 로 fetch 하기 -->
					<form id="form" style="margin: 20px;">
						<div class="mb-3">
							<label class="form-label" for="name">카테고리 이름</label>
							<input class="form-control" type="text" name="name" id="name"/>
							<div class="invalid-feedback" id="message"></div>
						</div>
						<button type="submit" class="btn btn-primary"> 카테고리 등록하기 </button>
					</form>
				</div>
			</div>

			<!-- wrapper 의 자식요소 2 -->
			<div class="box">
				<div class="card shadow mb-4">
					<div class="card-header py-3">
						<h6 class="m-0 font-weight-bold text-primary">카테고리 페이지 정보관리</h6>
					</div>

					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
								<thead>
									<tr>
										<th class="col" style="display:none">번호</th>
										<th class="col"><input class="form-check-input" type="checkbox"
												onclick="allChecked()" /></th>
										<th class="col-7">제목</th>
										<th class="col">수정</th>
										<th class="col"><button class="btn btn-danger btn-sm" value="${tmp.id}"
												onclick="deleteBtn()">삭제</button></th>
									</tr>
								</thead>
								<tbody>
									<!-- category 값이 null 이 아닌 경우에만 생성하기 -->
									<tr th:each="tmp : ${list}">
										<td th:text="${tmp.id}" style="display:none"></td>
										<td><input class="form-check-input" type="checkbox" /></td>
										<td th:text="${tmp.name}" class="category"></td>
										<td><button class="btn btn-success btn-sm" value="${tmp.id}">수정</button></td>
										<td><button class="btn btn-danger btn-sm" value="${tmp.id}">삭제</button></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!-- class="container" -->

	<script>
		/** form 관련 변수들 */
		const form = document.querySelector("#form");
		const formMessage = document.querySelector("#message")
		let nameInput = document.querySelector("#name");

		/** 나열된 리스트 정보 */
		const categoryList = [];
		let nodeList = document.querySelectorAll(".category")

		/** 반복문으로 DB에서 가져온 정보 모아두기 */
		nodeList.forEach(function (item) {
			categoryList.push(item.innerText);
		});

		/** 모아둔 정보 확인하기 */
		console.log(categoryList)

		/** 등록하기 누를 경우 작동 */
		form.addEventListener("submit", function (e) {
			e.preventDefault(); // 즉각 폼전송 방지 

			let name = nameInput.value;
			
			if (name == "") {
				nameInput.classList.add("is-invalid")
				formMessage.innerText = "정보를 입력하시지 않았습니다."
				
			} else if (categoryList.includes(name)) {
				nameInput.classList.add("is-invalid")
       			formMessage.innerText = "이미 존재하는 카테고리입니다.";

    		} else {
				/** 성공 및 등록 */
				const newCategory = new FormData(form);

				fetch("[[@{/}]]menu/category/insert", {
					method: "POST",
					body: newCategory
				})
				.then(res => res.text())
				.then(data => {
					/**
						현재 페이지 URL로 재전송하는 코드입니다.
						새로고침처럼 보일 순 있지만 조금 차이가 있습니다. 
						이 방법은 session를 유지할 수 있고 이전 데이터에서 최신화까지 가능합니다.
					*/
					window.location.href = window.location.href;
				})
			}
		});


		let updateBtn = document.querySelector(".btn btn-success btn-sm");

		/*
		updateBtn.addEventListener("click", function (e) {

			
				수정처리 순서 
				1.카테고리 이름을 가지고 메뉴DB 접속
				2.null 여부 확인 후 alert 로 사용자한테 알리기 
				3.변경한다면 이전 이름과 동일한 정보를 바탕으로 메뉴테이블에서 전부 가져오기 
				4.모두 변경 후 카테고리 테이블도 변경 
			
			const category = e.target.value;

			fetch()
				.then()
				.then()
		})
		*/


	</script>
</body>

</html>