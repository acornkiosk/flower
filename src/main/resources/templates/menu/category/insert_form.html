<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>카테고리 등록페이지</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>

<body>
	<div class="container">
		<h1>카테고리 등록 페이지</h1>
		<ul id="categoryList" class="list-group mt-3"></ul>
		<form th:action="@{/menu/category/insert}" method="post">
			
			<div class="mb-3">
				<label class="form-label" for="name">카테고리 이름</label>
				<input class="form-control" type="text" name="name" />	
			</div>
									
			<button type="submit" class="btn btn-primary"> 카테고리 등록하기 </button>
			
		</form>
	</div>
	<script>
		fetch("[[@{/}]]menu/category/getCategoryList")
		.then(res=>res.json()) // JSON 형식으로 파싱
		.then(data=>{
			console.log(data);
			const categoryList = document.getElementById('categoryList'); // 카테고리 리스트를 표시할 요소 선택
			
			// 카테고리 데이터를 반복하여 리스트 아이템으로 추가
			data.forEach(category => {
			    const listItem = document.createElement('li'); 
			    listItem.classList.add('list-group-item'); 
			    
			    // 카테고리 이름을 표시하는 span 요소 생성
			    const categoryNameSpan = document.createElement('span');
			    categoryNameSpan.textContent = category.name;
			    listItem.appendChild(categoryNameSpan); 
			    
			    // 삭제 버튼 생성
			    const deleteButton = document.createElement('button');
			    deleteButton.textContent = '삭제';
			    deleteButton.classList.add('btn', 'btn-danger', 'ms-2');
			    
			    // 데이터 속성을 사용하여 카테고리 ID 저장
			    deleteButton.dataset.categoryId = category.id;
			    
			    deleteButton.addEventListener('click', () => {
					
			        const categoryId = deleteButton.dataset.categoryId; 
			        console.log(categoryId)		       
			        deleteCategory(categoryId);  
			        listItem.remove(); // 해당 리스트 아이템 제거
			    });
			    listItem.appendChild(deleteButton); // 삭제 버튼을 리스트 아이템에 추가
			    
			    categoryList.appendChild(listItem); // 리스트에 아이템 추가
			
			});
			    function deleteCategory(categoryId) {
		   
				    fetch(`[[@{/}]]menu/category/delete/${categoryId}`)
				    .then(res=>res.json())
				    .then(data=>{
						console.log(data);
					})
				    .catch(error => console.error('Error ', error));
				}
		})
		.catch(error => console.error('Error ', error));
		
	</script>
</body>
</html>